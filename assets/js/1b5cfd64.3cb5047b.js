"use strict";(self.webpackChunklibrm_docs=self.webpackChunklibrm_docs||[]).push([[230],{8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>l});var t=r(6540);const o={},i=t.createContext(o);function s(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(i.Provider,{value:n},e.children)}},9198:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>u,contentTitle:()=>l,default:()=>a,frontMatter:()=>s,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"tutorials/buzzer","title":"\u8702\u9e23\u5668\u63a7\u5236\u5668","description":"\u672c\u4f8b\u7a0b\u6f14\u793a\u5982\u4f55\u4f7f\u7528 librm \u4e2d\u7684 BuzzerController \u7c7b\u63a7\u5236\u8702\u9e23\u5668\u64ad\u653e\u5404\u79cd\u97f3\u4e50\u548c\u63d0\u793a\u97f3\u3002","source":"@site/docs/tutorials/buzzer.mdx","sourceDirName":"tutorials","slug":"/tutorials/buzzer","permalink":"/tutorials/buzzer","draft":false,"unlisted":false,"editUrl":"https://github.com/XDU-IRobot/librm/tree/main/docs/docs/tutorials/buzzer.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u89d2\u5ea6\u8868\u793a\u4e0e\u8f6c\u6362","permalink":"/tutorials/angle"},"next":{"title":"\u7f16\u5199\u4e00\u4e2a CAN \u603b\u7ebf\u8bbe\u5907","permalink":"/tutorials/can-device"}}');var o=r(4848),i=r(8453);const s={},l="\u8702\u9e23\u5668\u63a7\u5236\u5668",u={},d=[{value:"\u4ee3\u7801\u793a\u4f8b",id:"\u4ee3\u7801\u793a\u4f8b",level:2}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"\u8702\u9e23\u5668\u63a7\u5236\u5668",children:"\u8702\u9e23\u5668\u63a7\u5236\u5668"})}),"\n",(0,o.jsxs)(n.p,{children:["\u672c\u4f8b\u7a0b\u6f14\u793a\u5982\u4f55\u4f7f\u7528 librm \u4e2d\u7684 ",(0,o.jsx)(n.code,{children:"BuzzerController"})," \u7c7b\u63a7\u5236\u8702\u9e23\u5668\u64ad\u653e\u5404\u79cd\u97f3\u4e50\u548c\u63d0\u793a\u97f3\u3002"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"BuzzerController"})," \u57fa\u4e8e ",(0,o.jsx)(n.code,{children:"SequencePlayer"})," \u5b9e\u73b0\uff0c\u652f\u6301\u97f3\u7b26\u5e8f\u5217\u64ad\u653e\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u51e0\u6761\u793a\u4f8b\u65cb\u5f8b\uff08\u542f\u52a8\u97f3\u3001\u9519\u8bef\u63d0\u793a\u3001\u6210\u529f\u63d0\u793a\u7b49\uff09\u3002"]}),"\n",(0,o.jsx)(n.h2,{id:"\u4ee3\u7801\u793a\u4f8b",children:"\u4ee3\u7801\u793a\u4f8b"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cpp",children:'#include "tim.h"\n#include "cmsis_os.h"\n\n#include <librm.hpp>\n\n// \u81ea\u5b9a\u4e49\u97f3\u4e50\uff1a\u4e24\u53ea\u8001\u864e\uff08\u7247\u6bb5\uff09\nclass TwoTigers : public rm::modules::BuzzerMelody {\n  using Freq = rm::modules::NoteFreqStandard;\n  using Duration = rm::modules::NoteDuration120;\n\n  rm::usize note_index_{0};\n  TimePoint note_start_time_;\n\n  static constexpr std::array kMelody = {\n      rm::modules::BuzzerNote(Freq::kC5, Duration::kQuarter),\n      rm::modules::BuzzerNote(Freq::kD5, Duration::kQuarter),\n      rm::modules::BuzzerNote(Freq::kE5, Duration::kQuarter),\n      rm::modules::BuzzerNote(Freq::kC5, Duration::kQuarter),\n      rm::modules::BuzzerNote(Freq::kC5, Duration::kQuarter),\n      rm::modules::BuzzerNote(Freq::kD5, Duration::kQuarter),\n      rm::modules::BuzzerNote(Freq::kE5, Duration::kQuarter),\n      rm::modules::BuzzerNote(Freq::kC5, Duration::kQuarter),\n  };\n\n public:\n  BuzzerNote Update(TimePoint now) override {\n    if (note_index_ >= kMelody.size()) {\n      return BuzzerNote(0, 0);  // \u64ad\u653e\u5b8c\u6bd5\n    }\n\n    auto note = kMelody[note_index_];\n    auto elapsed = ElapsedMs(note_start_time_, now);\n\n    if (elapsed >= note.duration) {\n      note_index_++;\n      note_start_time_ = now;\n    }\n\n    return note;\n  }\n\n  void Reset(TimePoint now) override {\n    note_index_ = 0;\n    note_start_time_ = now;\n  }\n};\n\nextern "C" void BuzzerTask(const void *pv_arg) {\n  // \u521b\u5efa\u8702\u9e23\u5668\u63a7\u5236\u5668\uff0c\u5305\u542b\u591a\u79cd\u97f3\u4e50\n  rm::modules::BuzzerController<\n      rm::modules::buzzer_melody::Silent,\n      rm::modules::buzzer_melody::Beeps<3>,\n      rm::modules::buzzer_melody::Startup,\n      rm::modules::buzzer_melody::Error,\n      rm::modules::buzzer_melody::Success,\n      rm::modules::buzzer_melody::SuperMario,\n      rm::modules::buzzer_melody::TheLick,\n      TwoTigers\n  > buzzer;\n\n  // \u542f\u52a8 PWM\n  HAL_TIM_PWM_Start(&htim4, TIM_CHANNEL_3);\n\n  // \u64ad\u653e\u542f\u52a8\u97f3\n  buzzer.Play<rm::modules::buzzer_melody::Startup>();\n\n  for (;;) {\n    // \u66f4\u65b0\u5e76\u83b7\u53d6\u5f53\u524d\u97f3\u7b26\n    auto note = buzzer.Update();\n\n    if (note.frequency > 0) {\n      // \u8bbe\u7f6e\u9891\u7387\uff1aARR = Timer_Clock / Frequency - 1\n      uint32_t arr = 1000000 / note.frequency - 1;\n      __HAL_TIM_SET_AUTORELOAD(&htim4, arr);\n      __HAL_TIM_SET_COMPARE(&htim4, TIM_CHANNEL_3, arr / 2);  // 50% \u5360\u7a7a\u6bd4\n    } else {\n      // \u9759\u97f3\n      __HAL_TIM_SET_COMPARE(&htim4, TIM_CHANNEL_3, 0);\n    }\n\n    osDelay(1);  // 1kHz \u66f4\u65b0\u9891\u7387\n  }\n}\n'})}),"\n",(0,o.jsxs)(n.admonition,{type:"tip",children:[(0,o.jsx)(n.p,{children:"librm \u5185\u5efa\u4e86\u51e0\u6761\u793a\u4f8b\u65cb\u5f8b\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff1a"}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Silent"})," - \u9759\u97f3"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Beeps<N>"})," - \u6ef4\u6ef4\u54cd N \u58f0"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Startup"})," - \u542f\u52a8\u63d0\u793a\u97f3"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Error"})," - \u9519\u8bef\u63d0\u793a\u97f3"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Success"})," - \u6210\u529f\u63d0\u793a\u97f3"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"SuperMario"})," - \u8d85\u7ea7\u9a6c\u91cc\u5965\u4e3b\u9898\u66f2\uff08\u7247\u6bb5\uff09"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"TheLick"})," - The Lick\uff08\u7235\u58eb\u7ecf\u5178\u4e50\u53e5\uff09"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"SeeUAgain"})," - See You Again\uff08\u7247\u6bb5\uff09"]}),"\n"]})]})]})}function a(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);