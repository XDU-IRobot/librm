"use strict";(self.webpackChunklibrm_docs=self.webpackChunklibrm_docs||[]).push([[859],{2474:(n,e,o)=>{o.r(e),o.d(e,{assets:()=>d,contentTitle:()=>a,default:()=>c,frontMatter:()=>m,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"tutorials/motor-drivers","title":"\u7535\u673a\u9a71\u52a8\u901f\u67e5","description":"\u672c\u6587\u6863\u5217\u4e3e librm \u4e2d\u5e38\u89c1\u7535\u673a\u9a71\u52a8\u7684\u57fa\u672c\u7528\u6cd5\u3002","source":"@site/docs/tutorials/motor-drivers.mdx","sourceDirName":"tutorials","slug":"/tutorials/motor-drivers","permalink":"/tutorials/motor-drivers","draft":false,"unlisted":false,"editUrl":"https://github.com/XDU-IRobot/librm/tree/main/docs/docs/tutorials/motor-drivers.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u59ff\u6001\u89e3\u7b97","permalink":"/tutorials/imu-fusion"},"next":{"title":"PID \u63a7\u5236\u5668","permalink":"/tutorials/pid"}}');var t=o(4848),i=o(8453);const m={},a="\u7535\u673a\u9a71\u52a8\u901f\u67e5",d={},l=[{value:"\u5927\u7586\u7535\u673a\uff08GM6020 / M3508 / M2006\uff09",id:"\u5927\u7586\u7535\u673agm6020--m3508--m2006",level:2},{value:"\u8fbe\u5999\u7535\u673a\uff08DM-J4310 \u7b49\uff09",id:"\u8fbe\u5999\u7535\u673adm-j4310-\u7b49",level:2},{value:"\u74f4\u63a7\u7535\u673a\uff08MG / MF / MH / MS \u7cfb\u5217\uff09",id:"\u74f4\u63a7\u7535\u673amg--mf--mh--ms-\u7cfb\u5217",level:2},{value:"\u5b87\u6811\u7535\u673a\uff08GO-M8010 \u7b49\uff09",id:"\u5b87\u6811\u7535\u673ago-m8010-\u7b49",level:2},{value:"\u5f20\u5927\u5934\u6b65\u8fdb\u9a71\u52a8",id:"\u5f20\u5927\u5934\u6b65\u8fdb\u9a71\u52a8",level:2},{value:"\u672c\u672b\u7535\u673a\uff08DirectDrive\uff09",id:"\u672c\u672b\u7535\u673adirectdrive",level:2},{value:"\u5b87\u6811 GO8010 \u7535\u673a",id:"\u5b87\u6811-go8010-\u7535\u673a",level:2},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2}];function s(n){const e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"\u7535\u673a\u9a71\u52a8\u901f\u67e5",children:"\u7535\u673a\u9a71\u52a8\u901f\u67e5"})}),"\n",(0,t.jsx)(e.p,{children:"\u672c\u6587\u6863\u5217\u4e3e librm \u4e2d\u5e38\u89c1\u7535\u673a\u9a71\u52a8\u7684\u57fa\u672c\u7528\u6cd5\u3002"}),"\n",(0,t.jsx)(e.h2,{id:"\u5927\u7586\u7535\u673agm6020--m3508--m2006",children:"\u5927\u7586\u7535\u673a\uff08GM6020 / M3508 / M2006\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-cpp",children:"#include <librm.hpp>\n\n// \u521d\u59cb\u5316 CAN \u603b\u7ebf\nrm::hal::Can can1(hcan1);\ncan1.SetFilter(0, 0);\ncan1.Begin();\n\n// \u521b\u5efa\u7535\u673a\u5bf9\u8c61\uff08ID 1-8\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a\u662f\u5426\u53cd\u8f6c\uff09\nrm::device::GM6020 yaw_motor(can1, 1);      // \u4e91\u53f0\u7535\u673a\nrm::device::M3508 wheel_motor(can1, 2);     // \u5e95\u76d8\u8f6e\u7535\u673a\nrm::device::M2006 friction_motor(can1, 3);  // \u6469\u64e6\u8f6e\u7535\u673a\n\n// \u63a7\u5236\u5faa\u73af\nfor (;;) {\n  // \u8bbe\u7f6e\u7535\u6d41\uff08GM6020: \xb130000, M3508: \xb116384, M2006: \xb110000\uff09\n  yaw_motor.SetCurrent(5000);\n  wheel_motor.SetCurrent(-8000);\n  friction_motor.SetCurrent(3000);\n\n  // \u7edf\u4e00\u53d1\u9001\u63a7\u5236\u6307\u4ee4\uff08\u53d1\u9001\u6240\u6709\u5927\u7586\u7535\u673a\uff09\n  rm::device::DjiMotor<>::SendCommand();\n\n  // \u6216\u8005\u53ea\u53d1\u9001\u7279\u5b9a\u578b\u53f7\n  // rm::device::GM6020::SendCommand();\n  // rm::device::M3508::SendCommand();\n\n  // \u8bfb\u53d6\u53cd\u9988\n  uint16_t encoder = yaw_motor.encoder();  // 0-8191\n  int16_t rpm = wheel_motor.rpm();\n  int16_t current = friction_motor.current();\n  uint8_t temp = yaw_motor.temperature();\n  float angle_deg = yaw_motor.pos_degree();  // 0-360\xb0\n  float angle_rad = yaw_motor.pos_rad();     // 0-2\u03c0\n\n  osDelay(1);\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u8fbe\u5999\u7535\u673adm-j4310-\u7b49",children:"\u8fbe\u5999\u7535\u673a\uff08DM-J4310 \u7b49\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-cpp",children:"#include <librm.hpp>\n\nrm::hal::Can can1(hcan1);\ncan1.Begin();\n\n// MIT \u6a21\u5f0f\uff08\u4f4d\u7f6e\u901f\u5ea6\u529b\u77e9\u6df7\u5408\u63a7\u5236\uff09\n// \u53c2\u6570\uff1amaster_id, slave_id, p_max, v_max, t_max, kp_range, kd_range\nrm::device::DmMotor<rm::device::DmMotorControlMode::kMit> dm_motor(\n    can1, {0x01, 0x01, 12.5f, 10.0f, 10.0f, {0.0f, 500.0f}, {0.0f, 5.0f}});\n\n// \u4f7f\u80fd\u7535\u673a\ndm_motor.SendInstruction(rm::device::DmMotorInstructions::kEnable);\nosDelay(10);\n\n// \u8bbe\u7f6e\u96f6\u70b9\ndm_motor.SendInstruction(rm::device::DmMotorInstructions::kSetZeroPosition);\nosDelay(10);\n\nfor (;;) {\n  // MIT \u6a21\u5f0f\u63a7\u5236\uff1a\u4f4d\u7f6e(rad)\u3001\u901f\u5ea6(rad/s)\u3001\u524d\u9988\u529b\u77e9(N\xb7m)\u3001kp\u3001kd\n  dm_motor.SetPosition(1.5f, 2.0f, 0.5f, 10.0f, 1.0f);\n\n  // \u8bfb\u53d6\u53cd\u9988\n  float pos = dm_motor.pos();      // rad\n  float vel = dm_motor.vel();      // rad/s\n  float torque = dm_motor.tau();   // N\xb7m\n  uint8_t status = dm_motor.status();\n  uint8_t mos_temp = dm_motor.mos_temperature();\n  uint8_t coil_temp = dm_motor.coil_temperature();\n\n  osDelay(1);\n}\n\n// \u5931\u80fd\u7535\u673a\ndm_motor.SendInstruction(rm::device::DmMotorInstructions::kDisable);\n\n// \u901f\u5ea6\u4f4d\u7f6e\u6a21\u5f0f\n// \u53c2\u6570\uff1amaster_id, slave_id, p_max, v_max, t_max\nrm::device::DmMotor<rm::device::DmMotorControlMode::kSpeedPosition> dm_motor2(\n    can1, {0x02, 0x02, 12.5f, 10.0f, 10.0f});\n\ndm_motor2.SendInstruction(rm::device::DmMotorInstructions::kEnable);\nosDelay(10);\n\nfor (;;) {\n  dm_motor2.SetPosition(3.14f, 2.0f);  // \u4f4d\u7f6e(rad)\u3001\u901f\u5ea6(rad/s)\n  osDelay(1);\n}\n\n// \u901f\u5ea6\u6a21\u5f0f\n// \u53c2\u6570\uff1amaster_id, slave_id, v_max, t_max\nrm::device::DmMotor<rm::device::DmMotorControlMode::kSpeed> dm_motor3(\n    can1, {0x03, 0x03, 10.0f, 10.0f});\n\ndm_motor3.SendInstruction(rm::device::DmMotorInstructions::kEnable);\nosDelay(10);\n\nfor (;;) {\n  dm_motor3.SetSpeed(5.0f);  // \u901f\u5ea6(rad/s)\n  osDelay(1);\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u74f4\u63a7\u7535\u673amg--mf--mh--ms-\u7cfb\u5217",children:"\u74f4\u63a7\u7535\u673a\uff08MG / MF / MH / MS \u7cfb\u5217\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-cpp",children:"#include <librm.hpp>\n\nrm::hal::Can can1(hcan1);\ncan1.Begin();\n\nrm::device::LkMotorMG<15> lk_motor_mg(can1, 1);      // MG \u7cfb\u5217\uff0c15 \u4f4d\u7f16\u7801\u5668\nrm::device::LkMotorMF<18> lk_motor_mf(can1, 2);      // MF \u7cfb\u5217\uff0c18 \u4f4d\u7f16\u7801\u5668\nrm::device::LkMotorMH<15> lk_motor_mh(can1, 3);      // MH \u7cfb\u5217\uff0c15 \u4f4d\u7f16\u7801\u5668\nrm::device::LkMotorMS<18> lk_motor_ms(can1, 4);      // MS \u7cfb\u5217\uff0c18 \u4f4d\u7f16\u7801\u5668\n\n// \u4f7f\u80fd\uff08\u6ce8\u610f\uff1a\u74f4\u63a7\u7535\u673a\u7684\u9a71\u52a8\u677f\u6709 bug\uff0c\u7ed9\u5b83\u53d1\u7684\u547d\u4ee4\u62a5\u6587\u4f1a\u88ab\u5ef6\u8fdf\u5904\u7406\uff0c\u5efa\u8bae\u591a\u53d1\u51e0\u6b21\uff09\nlk_motor_mg.SendInstruction(rm::device::LkMotor<rm::device::LkMotorType::kMG, 15>::Instruction::kEnable);\n\nfor (;;) {\n  // \u529b\u77e9\u63a7\u5236\uff08MF: \xb116.5N\xb7m, MG: \xb133N\xb7m\uff0cMS \u7cfb\u5217\u4e0d\u652f\u6301\uff09\n  lk_motor_mg.SetTorque(5.0f);  // N\xb7m\n\n  // MS \u7cfb\u5217\u652f\u6301\u5f00\u73af\u63a7\u5236\n  // lk_motor_ms.SetPower(500.0f);  // -850 ~ 850\n\n  // \u8bfb\u53d6\u53cd\u9988\uff08\u901a\u8fc7 feedback() \u8bbf\u95ee\u6240\u6709\u72b6\u6001\uff09\n  auto fb = lk_motor_mg.feedback();\n  float pos = fb.position_rad;     // rad\n  int16_t speed = fb.speed_rad_ps; // rad/s\n  float iq = fb.iq;                // \u8f6c\u77e9\u7535\u6d41(A)\n  int8_t temp = fb.temperature;    // \u6e29\u5ea6(\xb0C)\n  float voltage = fb.voltage;      // \u7535\u538b(V)\n  bool enabled = fb.enabled;       // \u4f7f\u80fd\u72b6\u6001\n\n  // \u68c0\u67e5\u9519\u8bef\u72b6\u6001\n  if (fb.error_state.over_current) {\n    // \u5904\u7406\u8fc7\u6d41\u9519\u8bef\n  }\n\n  osDelay(1);\n}\n\n// \u5931\u80fd\uff08\u5efa\u8bae\u591a\u53d1\u51e0\u6b21\uff09\nlk_motor_mg.SendInstruction(rm::device::LkMotor<rm::device::LkMotorType::kMG, 15>::Instruction::kDisable);\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u5b87\u6811\u7535\u673ago-m8010-\u7b49",children:"\u5b87\u6811\u7535\u673a\uff08GO-M8010 \u7b49\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-cpp",children:"#include <librm.hpp>\n\n// \u5b87\u6811\u7535\u673a\u4f7f\u7528\u4e32\u53e3\u901a\u4fe1\nrm::hal::Serial serial(huart1);\nrm::device::UnitreeMotor unitree_motor(serial, 0x01);  // \u4e32\u53e3\uff0c\u7535\u673aID\n\nfor (;;) {\n  // \u8bbe\u7f6e\u529b\u77e9\n  unitree_motor.SetTau(0.5f);  // N\xb7m\n  unitree_motor.SendCommend();\n\n  // \u8bfb\u53d6\u53cd\u9988\n  float pos = unitree_motor.pos();\n  float vel = unitree_motor.vel();\n  float torque = unitree_motor.tau();\n  int16_t acc = unitree_motor.acc();\n\n  osDelay(1);\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u5f20\u5927\u5934\u6b65\u8fdb\u9a71\u52a8",children:"\u5f20\u5927\u5934\u6b65\u8fdb\u9a71\u52a8"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-cpp",children:"#include <librm.hpp>\n\nrm::hal::Serial serial(huart1);\nrm::device::ZdtStepper stepper(serial, 0x01);\n\nfor (;;) {\n  // \u4f4d\u7f6e\u63a7\u5236\uff08\u901f\u5ea6 rpm\uff0c\u52a0\u901f\u5ea6\uff0c\u8109\u51b2\u6570\uff0c\u662f\u5426\u7edd\u5bf9\u4f4d\u7f6e\uff0c\u662f\u5426\u540c\u6b65\uff09\n  stepper.MotorPosCtrl(500, 50, 10000, false, false);\n\n  // \u901f\u5ea6\u63a7\u5236\uff08\u901f\u5ea6 rpm\uff0c\u52a0\u901f\u5ea6\uff0c\u662f\u5426\u540c\u6b65\uff09\n  // stepper.MotorVelCtrl(300, 50, false);\n\n  // \u8bfb\u53d6\u53cd\u9988\n  auto fb = stepper.feedback();\n  float pos = fb.pos;\n  float vel = fb.vel;\n\n  osDelay(1);\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u672c\u672b\u7535\u673adirectdrive",children:"\u672c\u672b\u7535\u673a\uff08DirectDrive\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-cpp",children:"#include <librm.hpp>\n\nrm::hal::Can can1(hcan1);\ncan1.Begin();\n\nrm::device::DirectDriveMotor dd_motor(can1, 0x01);\n\ndd_motor.Enable(true);\n\nfor (;;) {\n  // \u529b\u77e9\u63a7\u5236\uff08\u9700\u8981\u5148\u8bbe\u7f6e\u4e3a\u529b\u77e9\u63a7\u5236\u6a21\u5f0f\uff09\n  dd_motor.SetMode(rm::device::DirectDriveMotor::Mode::kTorque);\n  dd_motor.SetTorque(2.5f);  // N\xb7m\n\n  // \u8bfb\u53d6\u53cd\u9988\n  auto fb = dd_motor.feedback();\n  float rpm = fb.rpm;\n  float iq = fb.iq;\n  uint16_t encoder = fb.encoder;\n  float voltage = fb.master_voltage;\n\n  osDelay(1);\n}\n\ndd_motor.Enable(false);\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u5b87\u6811-go8010-\u7535\u673a",children:"\u5b87\u6811 GO8010 \u7535\u673a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-cpp",children:"#include <librm.hpp>\n\n// GO8010 \u7535\u673a\u4f7f\u7528\u4e32\u53e3\u901a\u4fe1\nrm::hal::Serial serial(huart1);\nrm::device::Go8010Motor go_motor(serial, 0x01);\n\nfor (;;) {\n  // \u8bbe\u7f6e\u529b\u77e9\n  go_motor.SetTau(0.5f);  // N\xb7m\n  go_motor.SendCommend();\n\n  // \u8bfb\u53d6\u53cd\u9988\n  float pos = go_motor.pos();\n  float vel = go_motor.vel();\n  float torque = go_motor.tau();\n\n  osDelay(1);\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,t.jsx)(e.admonition,{type:"warning",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u5927\u7586\u7535\u673a\u9700\u8981\u8c03\u7528 ",(0,t.jsx)(e.code,{children:"SendCommand()"})," \u7edf\u4e00\u53d1\u9001\u63a7\u5236\u547d\u4ee4\uff0c\u5176\u4ed6\u7535\u673a\u5728\u8bbe\u7f6e\u63a7\u5236\u503c\u65f6\u7acb\u5373\u53d1\u9001"]}),"\n"]})}),"\n",(0,t.jsx)(e.admonition,{type:"tip",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u4e32\u7ea7 PID \u63a7\u5236\u53c2\u8003 ",(0,t.jsx)(e.code,{children:"pid.mdx"})," \u6587\u6863"]}),"\n",(0,t.jsxs)(e.li,{children:["\u9700\u8981\u5e73\u6ed1\u8f68\u8ff9\u65f6\u914d\u5408 ",(0,t.jsx)(e.code,{children:"TrajectoryLimiter"})," \u4f7f\u7528"]}),"\n"]})})]})}function c(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(s,{...n})}):s(n)}},8453:(n,e,o)=>{o.d(e,{R:()=>m,x:()=>a});var r=o(6540);const t={},i=r.createContext(t);function m(n){const e=r.useContext(i);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:m(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);